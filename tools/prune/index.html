<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Prune-Backups.ps1 - Wesley Deal</title>
<link rel="stylesheet" href="/style.css">
<body id="prune">
<header>
	<nav>
		
		<a href="/">Wesley Deal</a>
		
		
		
		
		
		
		
		<span>/</span>
		
		<a href="https:&#x2F;&#x2F;deal.digital&#x2F;tools&#x2F;">Tools</a>
		
		<span>/</span>
		<a href="https:&#x2F;&#x2F;deal.digital&#x2F;tools&#x2F;prune&#x2F;">‚óè</a>
		
	</nav>
</header>
<section class="content">
	
<h1 class="title">
	Prune-Backups.ps1: Prune Backup Files with PowerShell
</h1>
<p>Do you have a program that dumps daily backups into a folder which would eat up your disk? Do you want to automatically delete some of those files but keep backups of certain ages? This is just the case for which I wrote <code>Prune-Backups.ps1</code></p>
<pre data-lang="ps1" class="language-ps1 z-code"><code class="language-ps1" data-lang="ps1"><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">param</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell">
</span></span><span class="z-source z-powershell"><span class="z-interpolated z-simple z-source z-powershell">	<span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">string</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Path</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-Location</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-keyword z-operator z-other z-powershell">,</span>
</span></span><span class="z-source z-powershell"><span class="z-interpolated z-simple z-source z-powershell">	<span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">int</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Hours</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-constant z-numeric z-integer z-powershell">0</span><span class="z-keyword z-operator z-other z-powershell">,</span>
</span></span><span class="z-source z-powershell"><span class="z-interpolated z-simple z-source z-powershell">	<span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">int</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Days</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-constant z-numeric z-integer z-powershell">0</span><span class="z-keyword z-operator z-other z-powershell">,</span>
</span></span><span class="z-source z-powershell"><span class="z-interpolated z-simple z-source z-powershell">	<span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">int</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Weeks</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-constant z-numeric z-integer z-powershell">0</span><span class="z-keyword z-operator z-other z-powershell">,</span>
</span></span><span class="z-source z-powershell"><span class="z-interpolated z-simple z-source z-powershell">	<span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">int</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Months</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-constant z-numeric z-integer z-powershell">0</span><span class="z-keyword z-operator z-other z-powershell">,</span>
</span></span><span class="z-source z-powershell"><span class="z-interpolated z-simple z-source z-powershell">	<span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">int</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Years</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-constant z-numeric z-integer z-powershell">0</span><span class="z-keyword z-operator z-other z-powershell">,</span>
</span></span><span class="z-source z-powershell"><span class="z-interpolated z-simple z-source z-powershell">	<span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">switch</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Summary</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-constant z-language z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>true</span><span class="z-keyword z-operator z-other z-powershell">,</span>
</span></span><span class="z-source z-powershell"><span class="z-interpolated z-simple z-source z-powershell">	<span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">switch</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>WhatIf</span>
</span></span><span class="z-source z-powershell"><span class="z-interpolated z-simple z-source z-powershell"></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>now</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Get-Date</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>hourlyDates</span>  <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-constant z-numeric z-integer z-powershell">0</span>..<span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Hours</span>  <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-keyword z-control z-powershell">%</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>now<span class="z-variable z-other z-member z-powershell">.addHours</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dailyDates</span>   <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-constant z-numeric z-integer z-powershell">0</span>..<span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Days</span>   <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-keyword z-control z-powershell">%</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>now<span class="z-variable z-other z-member z-powershell">.addDays</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>weeklyDates</span>  <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-constant z-numeric z-integer z-powershell">0</span>..<span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Weeks</span>  <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-keyword z-control z-powershell">%</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>now<span class="z-variable z-other z-member z-powershell">.addDays</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_</span><span class="z-keyword z-operator z-assignment z-powershell">*</span><span class="z-constant z-numeric z-integer z-powershell">7</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>monthlyDates</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-constant z-numeric z-integer z-powershell">0</span>..<span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Months</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-keyword z-control z-powershell">%</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>now<span class="z-variable z-other z-member z-powershell">.addMonths</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>yearlyDates</span>  <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-constant z-numeric z-integer z-powershell">0</span>..<span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Years</span>  <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-keyword z-control z-powershell">%</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>now<span class="z-variable z-other z-member z-powershell">.addYears</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>datesToKeep</span>  <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span> <span class="z-keyword z-operator z-assignment z-powershell">+</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>hourlyDates</span> <span class="z-keyword z-operator z-assignment z-powershell">+</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dailyDates</span> <span class="z-keyword z-operator z-assignment z-powershell">+</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>monthlyDates</span> <span class="z-keyword z-operator z-assignment z-powershell">+</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>weeklyDates</span> <span class="z-keyword z-operator z-assignment z-powershell">+</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>yearlyDates</span> <span class="z-keyword z-operator z-other z-powershell">|</span> Sort <span class="z-keyword z-operator z-assignment z-powershell">-</span>Unique
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>files</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Get-ChildItem</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Path <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Path</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>File
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-meta z-function z-powershell"><span class="z-storage z-type z-powershell">function</span> <span class="z-entity z-name z-function z-powershell">Get-ClosestFile</span></span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-keyword z-control z-powershell">param</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell">		<span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">datetime</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>referenceDate</span><span class="z-keyword z-operator z-other z-powershell">,</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell">		<span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">array</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>files</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell">	</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-keyword z-control z-powershell">foreach</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>file</span> <span class="z-keyword z-control z-powershell">in</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>files</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">		<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>diff</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">New-TimeSpan</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Start <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>file<span class="z-variable z-other z-member z-powershell">.LastWriteTime</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>End <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>referenceDate</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.Duration<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">		<span class="z-keyword z-control z-powershell">if</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-keyword z-operator z-unary z-powershell">!</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>smallestDiff</span> <span class="z-keyword z-operator z-logical z-powershell">-or</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>diff</span> <span class="z-keyword z-operator z-comparison z-powershell">-lt</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>smallestDiff</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">			<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>smallestDiff</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>diff</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">			<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>closestFile</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>file</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">		<span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-keyword z-control z-powershell">return</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>closestFile</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>filesToKeep</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">foreach</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>date</span> <span class="z-keyword z-control z-powershell">in</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>datesToKeep</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>file</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Get-ClosestFile</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>referenceDate <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>date</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>files <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>files</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-keyword z-control z-powershell">if</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>file</span> <span class="z-keyword z-operator z-comparison z-powershell">-ne</span> <span class="z-constant z-language z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>null</span> <span class="z-keyword z-operator z-logical z-powershell">-and</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>filesToKeep</span> <span class="z-keyword z-operator z-comparison z-powershell">-notcontains</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>file</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">		<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>filesToKeep</span> <span class="z-keyword z-operator z-assignment z-powershell">+=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>file</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>filesToKeep</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>filesToKeep</span> <span class="z-keyword z-operator z-other z-powershell">|</span> Sort LastWriteTime <span class="z-keyword z-operator z-assignment z-powershell">-</span>Unique
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>lengthDeleted</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-constant z-numeric z-integer z-powershell">0</span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>files</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-keyword z-control z-powershell">?</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span><span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_</span> <span class="z-keyword z-operator z-comparison z-powershell">-notin</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>filesToKeep</span><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-keyword z-control z-powershell">%</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>lengthDeleted</span> <span class="z-keyword z-operator z-assignment z-powershell">+=</span> <span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_<span class="z-variable z-other z-member z-powershell">.Length</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-keyword z-control z-powershell">if</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>WhatIf</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">		<span class="z-support z-function z-powershell">Write-Output</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">&quot;</span>WhatIf: Deleting file &#39;<span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-complex z-source z-powershell"><span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_<span class="z-variable z-other z-member z-powershell">.FullName</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>&#39; [<span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-complex z-source z-powershell"><span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_<span class="z-variable z-other z-member z-powershell">.LastWriteTime</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>]<span class="z-punctuation z-definition z-string z-end z-powershell">&quot;</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span> <span class="z-keyword z-control z-powershell">else</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">		<span class="z-support z-function z-powershell">Write-Output</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">&quot;</span>Deleting file &#39;<span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-complex z-source z-powershell"><span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_<span class="z-variable z-other z-member z-powershell">.FullName</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>&#39; [<span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-complex z-source z-powershell"><span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_<span class="z-variable z-other z-member z-powershell">.LastWriteTime</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>]<span class="z-punctuation z-definition z-string z-end z-powershell">&quot;</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">		<span class="z-support z-function z-powershell">Remove-Item</span> <span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Force
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Write-Output</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">&quot;</span>Operation complete.<span class="z-punctuation z-definition z-string z-end z-powershell">&quot;</span></span>
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">if</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>summary</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-support z-function z-powershell">Write-Output</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">&quot;</span>Retained files:<span class="z-punctuation z-definition z-string z-end z-powershell">&quot;</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>filesToKeep</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-keyword z-control z-powershell">%</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">&quot;</span> [<span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-complex z-source z-powershell"><span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_<span class="z-variable z-other z-member z-powershell">.LastWriteTime</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>] <span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-complex z-source z-powershell"><span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_<span class="z-variable z-other z-member z-powershell">.FullName</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-punctuation z-definition z-string z-end z-powershell">&quot;</span></span> <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>deleted</span>   <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">math</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::round<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>lengthDeleted</span><span class="z-keyword z-operator z-assignment z-powershell">/</span><span class="z-constant z-numeric z-integer z-powershell">1</span><span class="z-keyword z-other z-powershell">Mb</span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-constant z-numeric z-integer z-powershell">3</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>remaining</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">math</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::round<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>filesToKeep</span> <span class="z-keyword z-operator z-other z-powershell">|</span> Measure <span class="z-keyword z-operator z-assignment z-powershell">-</span>Sum Length</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.Sum<span class="z-keyword z-operator z-assignment z-powershell">/</span><span class="z-constant z-numeric z-integer z-powershell">1</span><span class="z-keyword z-other z-powershell">Mb</span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-constant z-numeric z-integer z-powershell">3</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>percentDeleted</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">math</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::round<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>deleted</span><span class="z-keyword z-operator z-assignment z-powershell">/</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>remaining</span><span class="z-keyword z-operator z-assignment z-powershell">+</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>deleted</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-constant z-numeric z-integer z-powershell">3</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-keyword z-operator z-assignment z-powershell">*</span><span class="z-constant z-numeric z-integer z-powershell">100</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-support z-function z-powershell">Write-Output</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">&quot;</span>Removed <span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-complex z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>deleted</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>MiB (<span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-complex z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>percentDeleted</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>%), kept <span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-complex z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>remaining</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>MiB<span class="z-punctuation z-definition z-string z-end z-powershell">&quot;</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></code></pre>
<p>Let‚Äôs say you want to keep a backup from every day of the last week, as well as copies from 2, 3, and 4 weeks ago, 1, 2, and 3 months ago, 1 and 2 years ago. You can try it from the folder in question with the <code>-WhatIf</code> flag:</p>
<pre data-lang="ps1" class="language-ps1 z-code"><code class="language-ps1" data-lang="ps1"><span class="z-source z-powershell">.<span class="z-keyword z-operator z-assignment z-powershell">/</span>Prune<span class="z-keyword z-operator z-assignment z-powershell">-</span>Backups.ps1 <span class="z-keyword z-operator z-assignment z-powershell">-</span>Days <span class="z-constant z-numeric z-integer z-powershell">7</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Weeks <span class="z-constant z-numeric z-integer z-powershell">4</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Months <span class="z-constant z-numeric z-integer z-powershell">3</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Years <span class="z-constant z-numeric z-integer z-powershell">2</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>WhatIf
</span></code></pre>
<p>It will report back which files would be deleted, which would be kept, and how much space you‚Äôll save.</p>
<p>Now you can create a scheduled daily task, pointing to a specific path and removing the <code>-WhatIf</code> flag:</p>
<blockquote>
<p><strong>Program/script</strong>: <code>C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</code><br />
<strong>Add arguments (optional)</strong>: <code>-NoProfile -NonInteractive -ExecutionPolicy Bypass -File C:\Scripts\Prune-Backups.ps1 -Path &quot;C:\ProgramData\Vendor\Backups\&quot; -Days 7 -Weeks 4 -Months 3 -Years 2</code></p>
</blockquote>
<p><strong>Note:</strong> No matter what, the most recent item in the folder will be kept. The default behavior of the script, if called with no parameters, is to keep only the most recent file.</p>


<section class="article-signoff">
	
	
	
</section>


</section>
<footer>
	No rights reserved. <a href="https://github.com/wesleydeal/deal.digital/edit/master/content/tools&#x2F;prune.md">View source here</a>. Provided as-is, no warranty, etc.
	Built 2024-05-14 16:01:58 UTC with <a href="https://www.getzola.org/">Zola</a> on GitHub <a href="https://github.com/wesleydeal/deal.digital/actions">Actions</a>, hosted on GitHub Pages.
	Thanks to Red Hat for <a href="https://www.redhat.com/en/about/brand/standards/typography">the typefaces</a>.
</footer>
</body>
</html>